# 一. 分布式锁

## 1.1 为什么要使用分布式锁

​		我们在开发应用的时候，如果需要对某一个共享变量进行多线程同步访问的时候，可以使用我们学到的Java多线程的进行处理，并且可以完美的运行，毫无Bug！

​		注意这是单机应用，也就是所有的请求都会分配到当前服务器的JVM内部，然后映射为操作系统的线程进行处理！而这个共享变量只是在这个JVM内部的一块内存空间！

​		分布式锁一般有三种实现方式：

1. 数据库乐观锁
2. 基于Redis的分布式锁
3. 基于ZooKeeper的分布式锁

## 1.2 需要满足的特性

1. 分布式锁应具备哪些条件

   - 在分布式系统环境下，一个方法在同一时间只能被一个机器的一个线程执行（互斥性）
   - 高可用、高性能的获取锁与释放锁
   - 具备可重入特性
   - 具备锁失效机制，防止死锁
   - 具备非阻塞锁特性，即没有获取到锁将直接返回获取锁失败

2. 为了确保分布式锁可用，我们至少要确保锁的实现同时满足以下四个条件

   - 互斥性

     在任意时刻只有一个客户端可以获取锁

   - 不会发生死锁

     即使有一个客户端在持有锁的期间崩溃而没有主动解锁，也能保证后续客户端能加锁，加一个有效时间

   - 持锁人解锁

     加锁和解锁必须是同一个客户端，客户端不能把别人加的锁给解了

   - 可重入

     当一个客户端获取锁对象之后，这个客户端可以再次获取该对象上的锁

   - 具有容错性

     只要大部分的Redis节点正常运行，客户端就可以加锁和解锁

### 1.3 分布式锁三种实现方式

